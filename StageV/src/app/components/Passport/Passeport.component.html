<!-- Passeport.component.html -->
<div class="passport-card">
  <!-- üîô Bouton retour -->
  <button class="back-btn" onclick="window.location.href='/passportliste'">‚¨Ö Retour √† la liste des passeports</button>

  <h2>Cr√©er un nouveau passeport</h2>

  <!-- Message de succ√®s seulement -->
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
    <button type="button" class="close-btn" (click)="closeSuccessMessage()">√ó</button>
  </div>

  <form (ngSubmit)="onSubmit()" #passportForm="ngForm" class="passport-form">

    <div class="form-group">
      <label for="firstName">Pr√©nom <span class="required">*</span></label>
      <input
        id="firstName"
        name="firstName"
        type="text"
        [(ngModel)]="newPassport.firstName"
        (blur)="validateField('firstName', newPassport.firstName)"
        (input)="validateField('firstName', newPassport.firstName)"
        required
        placeholder="Entrez le pr√©nom"
        maxlength="50"
        [class.error-field]="hasFieldError('firstName')"
      />
      <div *ngIf="hasFieldError('firstName')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('firstName') }}
      </div>
    </div>

    <div class="form-group">
      <label for="lastName">Nom <span class="required">*</span></label>
      <input
        id="lastName"
        name="lastName"
        type="text"
        [(ngModel)]="newPassport.lastName"
        (blur)="validateField('lastName', newPassport.lastName)"
        (input)="validateField('lastName', newPassport.lastName)"
        required
        placeholder="Entrez le nom"
        maxlength="50"
        [class.error-field]="hasFieldError('lastName')"
      />
      <div *ngIf="hasFieldError('lastName')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('lastName') }}
      </div>
    </div>

    <div class="form-group">
      <label for="nationality">Nationalit√© <span class="required">*</span></label>
      <input
        id="nationality"
        name="nationality"
        type="text"
        [(ngModel)]="newPassport.nationality"
        (blur)="validateField('nationality', newPassport.nationality)"
        (input)="validateField('nationality', newPassport.nationality)"
        required
        placeholder="Ex: Tunisienne"
        maxlength="30"
        [class.error-field]="hasFieldError('nationality')"
      />
      <div *ngIf="hasFieldError('nationality')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('nationality') }}
      </div>
    </div>

    <div class="form-group">
      <label for="sex">Sexe <span class="required">*</span></label>
      <select
        id="sex"
        name="sex"
        [(ngModel)]="newPassport.sex"
        (change)="validateField('sex', newPassport.sex)"
        required
        [class.error-field]="hasFieldError('sex')"
      >
        <option value="">S√©lectionnez</option>
        <option value="M">Masculin</option>
        <option value="F">F√©minin</option>
      </select>
      <div *ngIf="hasFieldError('sex')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('sex') }}
      </div>
    </div>

    <div class="form-group">
      <label for="dateOfBirth">Date de naissance <span class="required">*</span></label>
      <input
        id="dateOfBirth"
        name="dateOfBirth"
        type="date"
        [(ngModel)]="newPassport.dateOfBirth"
        (change)="validateField('dateOfBirth', newPassport.dateOfBirth)"
        required
        [class.error-field]="hasFieldError('dateOfBirth')"
      />
      <div *ngIf="hasFieldError('dateOfBirth')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('dateOfBirth') }}
      </div>
    </div>

    <div class="form-group">
      <label for="placeOfBirth">Lieu de naissance <span class="required">*</span></label>
      <input
        id="placeOfBirth"
        name="placeOfBirth"
        type="text"
        [(ngModel)]="newPassport.placeOfBirth"
        (blur)="validateField('placeOfBirth', newPassport.placeOfBirth)"
        (input)="validateField('placeOfBirth', newPassport.placeOfBirth)"
        required
        placeholder="Ville, Pays"
        maxlength="100"
        [class.error-field]="hasFieldError('placeOfBirth')"
      />
      <div *ngIf="hasFieldError('placeOfBirth')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('placeOfBirth') }}
      </div>
    </div>

    <div class="form-group">
      <label for="address">Adresse <span class="required">*</span></label>
      <input
        id="address"
        name="address"
        type="text"
        [(ngModel)]="newPassport.address"
        (blur)="validateField('address', newPassport.address)"
        (input)="validateField('address', newPassport.address)"
        required
        placeholder="Adresse compl√®te"
        maxlength="200"
        [class.error-field]="hasFieldError('address')"
      />
      <div *ngIf="hasFieldError('address')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('address') }}
      </div>
    </div>
    <div class="form-group">
      <label for="passportNumber">Num√©ro de passeport <span class="required">*</span></label>
      <input
        id="passportNumber"
        name="passportNumber"
        type="number"
        [(ngModel)]="newPassport.passportNumber"
        (blur)="validateField('passportNumber', newPassport.passportNumber)"
        (input)="validateField('passportNumber', newPassport.passportNumber)"
        required
        placeholder="Entrez le num√©ro du passeport"
        [class.error-field]="hasFieldError('passportNumber')"
      />
      <div *ngIf="hasFieldError('passportNumber')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('passportNumber') }}
      </div>
    </div>


    <div class="form-group">
      <label for="dateOfIssue">Date de d√©livrance <span class="required">*</span></label>
      <input
        id="dateOfIssue"
        name="dateOfIssue"
        type="date"
        [(ngModel)]="newPassport.dateOfIssue"
        (change)="validateField('dateOfIssue', newPassport.dateOfIssue)"
        required
        [class.error-field]="hasFieldError('dateOfIssue')"
      />
      <div *ngIf="hasFieldError('dateOfIssue')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('dateOfIssue') }}
      </div>
    </div>

    <!-- Section pour la date d'expiration avec alerte visuelle -->
    <div class="form-group">
      <label for="dateOfExpiry">Date d'expiration <span class="required">*</span></label>
      <input
        id="dateOfExpiry"
        name="dateOfExpiry"
        type="date"
        [(ngModel)]="newPassport.dateOfExpiry"
        (change)="validateField('dateOfExpiry', newPassport.dateOfExpiry)"
        required
        [class.error-field]="hasFieldError('dateOfExpiry')"
        [class.warning-field]="isExpiringWithinSixMonths('dateOfExpiry')"
      />

      <!-- Message d'erreur ou d'avertissement -->
      <div *ngIf="hasFieldError('dateOfExpiry')"
           class="error-message"
           [class.warning-message]="isExpiringWithinSixMonths('dateOfExpiry')">
        <i class="error-icon"
           [class]="isExpiringWithinSixMonths('dateOfExpiry') ? 'warning-icon' : 'error-icon'">
          {{ isExpiringWithinSixMonths('dateOfExpiry') ? '‚ö†Ô∏è' : '‚ö†' }}
        </i>
        {{ getFieldError('dateOfExpiry') }}

        <!-- Affichage du nombre de jours restants si applicable -->
        <span *ngIf="isExpiringWithinSixMonths('dateOfExpiry') && getDaysUntilExpiry() !== null"
              class="days-remaining">
      ({{ getDaysUntilExpiry() }} jours restants)
    </span>
      </div>

      <!-- Message informatif additionnel pour les expirations proches -->
      <div *ngIf="isExpiringWithinSixMonths('dateOfExpiry')" class="info-message">
        <i class="info-icon">‚ÑπÔ∏è</i>
        Recommandation : Renouvelez le passeport d√®s que possible pour √©viter les probl√®mes de voyage.
      </div>
    </div>

    <div class="form-group">
      <label for="issuingAuthority">Autorit√© de d√©livrance <span class="required">*</span></label>
      <input
        id="issuingAuthority"
        name="issuingAuthority"
        type="text"
        [(ngModel)]="newPassport.issuingAuthority"
        (blur)="validateField('issuingAuthority', newPassport.issuingAuthority)"
        (input)="validateField('issuingAuthority', newPassport.issuingAuthority)"
        required
        placeholder="Ex: Minist√®re de l'Int√©rieur"
        maxlength="100"
        [class.error-field]="hasFieldError('issuingAuthority')"
      />
      <div class="form-group">
        <label for="occupation">Profession</label>
        <input
          id="occupation"
          name="occupation"
          type="text"
          [(ngModel)]="newPassport.occupation"
          (blur)="validateField('occupation', newPassport.occupation)"
          (input)="validateField('occupation', newPassport.occupation)"
          placeholder="Entrez la profession"
          maxlength="100"
          [class.error-field]="hasFieldError('occupation')"
        />
        <div *ngIf="hasFieldError('occupation')" class="error-message">
          <i class="error-icon">‚ö†</i> {{ getFieldError('occupation') }}
        </div>
      </div>

      <div *ngIf="hasFieldError('issuingAuthority')" class="error-message">
        <i class="error-icon">‚ö†</i> {{ getFieldError('issuingAuthority') }}
      </div>
    </div>

    <div class="form-actions">
      <button type="submit">Cr√©er le passeport</button>
    </div>

  </form>
</div>
