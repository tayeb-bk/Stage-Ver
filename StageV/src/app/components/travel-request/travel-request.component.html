<div class="travel-request-container">
  <h2>Gestion des Demandes de Voyage</h2>

  <!-- Messages d'alerte -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <!-- Formulaire de cr√©ation / modification -->
  <div class="form-section">
    <h3>{{ isEditing ? 'Modifier une demande' : 'Nouvelle demande' }}</h3>
    <form (ngSubmit)="saveTravelRequest()">
      <div class="form-row">
        <div class="form-group">
          <label for="projectSelect">Projet</label>
          <select
            id="projectSelect"
            [(ngModel)]="newTravelRequest.project"
            name="project"
            (change)="onProjectChange(newTravelRequest.project)"
            required
          >
            <option [ngValue]="undefined">-- S√©lectionner un projet --</option>
            <option *ngFor="let project of projects" [ngValue]="project">
              {{ project.name }} ({{ project.code }})
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="missionSelect">Mission</label>
          <select id="missionSelect" [(ngModel)]="newTravelRequest.mission" name="mission" required>
            <option [ngValue]="undefined">-- S√©lectionner une mission --</option>
            <option *ngFor="let mission of missions" [ngValue]="mission">{{ mission.name }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="destination">Destination</label>
          <input type="text" id="destination" [(ngModel)]="newTravelRequest.destination" name="destination" required />
        </div>
        <div class="form-group">
          <label for="secondaryDestination">Destination secondaire</label>
          <input type="text" id="secondaryDestination" [(ngModel)]="newTravelRequest.secondaryDestination" name="secondaryDestination" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="objective">Objectif</label>
          <input type="text" id="objective" [(ngModel)]="newTravelRequest.objective" name="objective" required />
        </div>
        <div class="form-group">
          <label for="type">Type</label>
          <input type="text" id="type" [(ngModel)]="newTravelRequest.type" name="type" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="departureDate">Date de d√©part</label>
          <input type="date" id="departureDate" [(ngModel)]="newTravelRequest.departureDate" name="departureDate" required />
        </div>
        <div class="form-group">
          <label for="returnDate">Date de retour</label>
          <input type="date" id="returnDate" [(ngModel)]="newTravelRequest.returnDate" name="returnDate" required />
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success">{{ isEditing ? 'Mettre √† jour' : 'Cr√©er' }}</button>
        <button type="button" *ngIf="isEditing" class="btn btn-secondary" (click)="resetForm()">Annuler</button>
      </div>
    </form>
  </div>

  <!-- Section de filtrage -->
  <div class="filter-section">
    <h3>Filtrer les demandes</h3>
    <div class="filter-row">
      <div class="filter-group">
        <label for="filterProject">Projet</label>
        <select id="filterProject" [(ngModel)]="filters.project" (change)="applyFilters()">
          <option value="">Tous les projets</option>
          <option *ngFor="let project of projects" [value]="project.name">{{ project.name }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterMission">Mission</label>
        <select id="filterMission" [(ngModel)]="filters.mission" (change)="applyFilters()">
          <option value="">Toutes les missions</option>
          <option *ngFor="let mission of getAllMissions()" [value]="mission.name">{{ mission.name }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterDestination">Destination</label>
        <input type="text" id="filterDestination" [(ngModel)]="filters.destination"
               (input)="applyFilters()" placeholder="Rechercher destination...">
      </div>

      <div class="filter-group">
        <label for="filterStatus">Statut</label>
        <select id="filterStatus" [(ngModel)]="filters.status" (change)="applyFilters()">
          <option value="">Tous les statuts</option>
          <option value="Pending">En attente</option>
          <option value="Approved">Approuv√©</option>
          <option value="Rejected">Rejet√©</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterDateFrom">Date de d√©part √† partir de</label>
        <input type="date" id="filterDateFrom" [(ngModel)]="filters.dateFrom" (change)="applyFilters()">
      </div>

      <div class="filter-group">
        <label for="filterDateTo">Date de d√©part jusqu'√†</label>
        <input type="date" id="filterDateTo" [(ngModel)]="filters.dateTo" (change)="applyFilters()">
      </div>
    </div>

    <div class="filter-actions">
      <button type="button" class="btn btn-secondary" (click)="clearFilters()">R√©initialiser les filtres</button>
      <span class="result-count">{{ filteredTravelRequests.length }} demande(s) trouv√©e(s)</span>
    </div>
  </div>

  <!-- Tableau des demandes avec scroll -->
  <div class="table-section">
    <h3>Liste des demandes de voyage</h3>
    <div class="table-container">
      <table class="travel-table">
        <thead>
        <tr>
          <th>ID</th>
          <th>Projet</th>
          <th>Mission</th>
          <th>Destination</th>
          <th>Objectif</th>
          <th>Type</th>
          <th>D√©part</th>
          <th>Retour</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let tr of filteredTravelRequests">
          <td>{{ tr.id }}</td>
          <td>{{ tr.project?.name }}</td>
          <td>{{ tr.mission?.name }}</td>
          <td>{{ tr.destination }}</td>
          <td>{{ tr.objective }}</td>
          <td>{{ tr.type }}</td>
          <td>{{ tr.departureDate | date:'dd/MM/yyyy' }}</td>
          <td>{{ tr.returnDate | date:'dd/MM/yyyy' }}</td>
          <td>
            <span class="status-badge" [ngClass]="'status-' + tr.status?.toLowerCase()">
              {{ tr.status }}
            </span>
          </td>
          <td>
            <button class="btn btn-edit" (click)="editTravelRequest(tr)" title="Modifier">‚úèÔ∏è</button>
            <button class="btn btn-delete" (click)="deleteTravelRequest(tr.id!)" title="Supprimer">üóëÔ∏è</button>
          </td>
        </tr>
        <tr *ngIf="filteredTravelRequests.length === 0">
          <td colspan="10" class="no-data">Aucune demande trouv√©e</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
